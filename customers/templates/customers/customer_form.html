{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ action }} Customer</title>
    <link href="{% static 'css/output.css' %}" rel="stylesheet">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #F8F9FA;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333333;
            margin-bottom: 20px;
        }
        form {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px 20px;
            align-items: center;
        }
        label {
            font-weight: bold;
            text-align: right;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #1E90FF;
            outline: none;
        }
        .form-actions {
            grid-column: span 2;
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #1E90FF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}
    <div class="container">
        <h2>{{ action }} Customer</h2>
        <form method="post">
            {% csrf_token %}
            {# Render only the non-location fields from the form #}
            {% for field in form %}
                {% if field.name not in 'region province barangay' %}
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                {% endif %}
            {% endfor %}

            {# Now render your custom region/province/barangay fields here #}
            <label for="id_region">Region:</label>
            <select id="id_region" name="region">
                <option value="">Select a Region</option>
                {% for region in form.fields.region.queryset %}
                    <option value="{{ region.id }}" {% if form.initial.region == region.id %}selected{% endif %}>{{ region.name }}</option>
                {% endfor %}
            </select>

            <label for="id_province">Province:</label>
            <select id="id_province" name="province">
                <option value="">Select a Province</option>
                {% if form.initial.province %}
                    <option value="{{ form.initial.province.id }}" selected>{{ form.initial.province.name }}</option>
                {% endif %}
            </select>

            <label for="id_barangay">Barangay:</label>
            <select id="id_barangay" name="barangay">
                <option value="">Select a Barangay</option>
                {% if form.initial.barangay %}
                    <option value="{{ form.initial.barangay.id }}" selected>{{ form.initial.barangay.name }}</option>
                {% endif %}
            </select>
            <div class="form-actions">
                <button type="submit">{{ action }}</button>
                <a href="{% url 'order_create' %}" class="cancel-btn" style="margin-left: 10px; background: #ff4d4d; text-decoration: none;">Cancel</a>
            </div>
        </form>
    </div>
    <script>
    document.getElementById('id_region').addEventListener('change', function() {
        var regionId = this.value;
        var provinceSelect = document.getElementById('id_province');
        var barangaySelect = document.getElementById('id_barangay');
        provinceSelect.innerHTML = '<option value="">Select a Province</option>';
        barangaySelect.innerHTML = '<option value="">Select a Barangay</option>';
        if(regionId) {
            fetch('/core/ajax/get_provinces/?region_id=' + regionId)
                .then(response => response.json())
                .then(data => {
                    data.forEach(function(province) {
                        var option = document.createElement('option');
                        option.value = province.id;
                        option.text = province.name;
                        provinceSelect.add(option);
                    });
                });
        }
    });

    document.getElementById('id_province').addEventListener('change', function() {
        var provinceId = this.value;
        var barangaySelect = document.getElementById('id_barangay');
        barangaySelect.innerHTML = '<option value="">Select a Barangay</option>';
        if(provinceId) {
            fetch('/core/ajax/get_barangays/?province_id=' + provinceId)
                .then(response => response.json())
                .then(data => {
                    data.forEach(function(barangay) {
                        var option = document.createElement('option');
                        option.value = barangay.id;
                        option.text = barangay.name;
                        barangaySelect.add(option);
                    });
                });
        }
    });
    </script>
</body>
</html>